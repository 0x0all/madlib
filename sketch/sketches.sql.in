DROP FUNCTION IF EXISTS  big_or(bitmap1 bytea, bitmap2 bytea) CASCADE;
CREATE FUNCTION big_or(bitmap1 bytea, bitmap2 bytea)
RETURNS bytea
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS fmsketch_iter(bitmaps bytea, input anyelement) CASCADE;
CREATE FUNCTION fmsketch_iter(bitmaps bytea, input anyelement) 
RETURNS bytea 
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS fmsketch_getcount(bitmaps bytea) CASCADE;
CREATE FUNCTION fmsketch_getcount(bitmaps bytea) 
RETURNS bigint 
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS fmsketch_merge(bitmaps1 bytea, bitmaps2 bytea) CASCADE;
CREATE FUNCTION fmsketch_merge(bitmaps1 bytea, bitmaps2 bytea) 
RETURNS bytea 
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP AGGREGATE IF EXISTS fmcount(anyelement);
CREATE AGGREGATE fmcount(anyelement)
(
    sfunc = fmsketch_iter,
    stype = bytea, 
    finalfunc = fmsketch_getcount,
--  UNCOMMENT THE NEXT LINE TO PARALLELIZE ON GREENPLUM
--    prefunc = fmsketch_merge,
    initcond = '' 
);

DROP FUNCTION IF EXISTS cmsketch_iter(bytea, anyelement) CASCADE;
CREATE FUNCTION cmsketch_iter(bitmaps bytea, input anyelement) 
RETURNS bytea 
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS cmsketch_out(bytea) CASCADE;
CREATE FUNCTION cmsketch_out(counters bytea) 
RETURNS bytea 
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS cmsketch_combine(bytea, bytea) CASCADE;
CREATE FUNCTION cmsketch_combine(bytea, bytea) 
RETURNS bytea
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP AGGREGATE IF EXISTS cmsketch(bigint);
CREATE AGGREGATE cmsketch(anyelement)
(
    sfunc = cmsketch_iter,
    stype = bytea, 
    finalfunc = cmsketch_out,
    initcond = ''
--  UNCOMMENT THE NEXT LINE TO PARALLELIZE ON GREENPLUM
--    , prefunc = cmsketch_combine
);

DROP FUNCTION IF EXISTS cmsketch_getcount(bytea, anyelement) CASCADE;
CREATE FUNCTION cmsketch_getcount(counters bytea, val anyelement) 
RETURNS bigint 
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS cmsketch_rangecount(bytea, anyelement, anyelement) CASCADE;
CREATE FUNCTION cmsketch_rangecount(bytea, anyelement, anyelement)
RETURNS bigint
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS cmsketch_centile(bytea, int4) CASCADE;
CREATE FUNCTION cmsketch_centile(bytea, int4)
RETURNS bigint
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;

DROP FUNCTION IF EXISTS cmsketch_histogram(bytea, int4) CASCADE;
CREATE FUNCTION cmsketch_histogram(bytea, int4)
RETURNS bigint[]
AS 'MODULE_PATHNAME'
LANGUAGE C STRICT;