set search_path to "$user",public,madlib;
-- Basic methods
select cmsketch_getcount(cmsketch(i),5) from generate_series(1,10000) as T(i);
 cmsketch_getcount 
-------------------
                10
(1 row)

select cmsketch_rangecount(cmsketch(i),1,1025) from generate_series(1,10000) as T(i);
 cmsketch_rangecount 
---------------------
                1033
(1 row)

select cmsketch_rangecount(cmsketch(i), 1,200) from generate_series(1,10000) as R(i);
 cmsketch_rangecount 
---------------------
                 213
(1 row)

select cmsketch_width_histogram(cmsketch(i), min(i), max(i), 4) from generate_series(1,10000) as R(i);
                            cmsketch_width_histogram                            
--------------------------------------------------------------------------------
 [0:3][0:2]={{1,2500,2511},{2501,5000,2515},{5001,7500,2516},{7501,10000,2516}}
(1 row)

select mini,
       cmsketch_centile(sketch, 25) AS quartile1, 
       cmsketch_centile(sketch, 50) AS quartile2, 
       cmsketch_centile(sketch, 75) AS quartile3,
       maxi 
  from (select min(i) as mini, cmsketch(i) as sketch, max(i) as maxi 
          from generate_series(1,10000) as R(i)) as T;
 mini | quartile1 | quartile2 | quartile3 | maxi  
------+-----------+-----------+-----------+-------
    1 |           |           |           | 10000
(1 row)

select cmsketch_depth_histogram(cmsketch(i), 4) from generate_series(1,10000) as R(i);
                             cmsketch_depth_histogram                              
-----------------------------------------------------------------------------------
 [0:3][0:2]={{9223372036854775807,0,0},{1,0,0},{1,0,0},{1,-9223372036854775808,0}}
(1 row)

-- tests for all-NULL column
select cmsketch(NULL) from generate_series(1,10000) as R(i) where i < 0;
 cmsketch 
----------
 
(1 row)

select cmsketch_centile(cmsketch(NULL), 2) from generate_series(1,10000) as R(i) where i < 0;
 cmsketch_centile 
------------------
                 
(1 row)

