SET client_min_messages = 'ERROR';

DROP function IF EXISTS MADLIB_SCHEMA.install_test();
CREATE FUNCTION MADLIB_SCHEMA.install_test() RETURNS TEXT AS $$ 
declare
	result TEXT;
	a1 FLOAT;
	a2 FLOAT;
	a3 FLOAT;
begin
	DROP TABLE IF EXISTS MADLIB_SCHEMA.A;
	CREATE TABLE MADLIB_SCHEMA.A(
		val FLOAT
	) DISTRIBUTED BY (val);

	INSERT INTO MADLIB_SCHEMA.A SELECT random() FROM generate_series(1,1000);
	SELECT INTO a1 val FROM MADLIB_SCHEMA.A ORDER BY val OFFSET 498 LIMIT 499;
	SELECT INTO a3 val FROM MADLIB_SCHEMA.A ORDER BY val OFFSET 500 LIMIT 501;
	SELECT INTO a2 MADLIB_SCHEMA.quantile('MADLIB_SCHEMA.A', 'val', .5);

	SELECT INTO result CASE WHEN((a3-a2)*(a3-a2) <= (a1-a3)*(a1-a3)) THEN 'PASS' ELSE 'FAILED' END;
	DROP TABLE IF EXISTS MADLIB_SCHEMA.A;
	RETURN result;
end $$ language plpgsql;

SELECT MADLIB_SCHEMA.install_test();
DROP FUNCTION MADLIB_SCHEMA.install_test();